-- Roblox ESP Script
-- Place this in a script executor

-- == CONFIGURATION ==
local ESP_Enabled = true  -- Set this to false to disable the ESP
-- =====================

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

-- Player and Camera
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- ESP Table to store created GUI elements
local ESP_Objects = {}

-- Function to create ESP for a player
local function createESP(player)
    if player == LocalPlayer or ESP_Objects[player] then return end

    local character = player.Character or player.CharacterAdded:Wait()
    local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
    
    local espBox = Instance.new("BoxHandleAdornment")
    espBox.Size = Vector3.new(4, 5, 2)
    espBox.Color3 = Color3.new(0, 1, 0) -- Green color
    espBox.Transparency = 0.5
    espBox.AlwaysOnTop = true
    espBox.ZIndex = 10
    espBox.Adornee = humanoidRootPart
    espBox.Parent = humanoidRootPart

    local espName = Instance.new("BillboardGui")
    espName.Name = "ESP_Name"
    espName.Size = UDim2.new(0, 100, 0, 40)
    espName.StudsOffset = Vector3.new(0, 3, 0)
    espName.AlwaysOnTop = true
    espName.Parent = humanoidRootPart

    local nameLabel = Instance.new("TextLabel")
    nameLabel.Size = UDim2.new(1, 0, 1, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = player.Name
    nameLabel.TextColor3 = Color3.new(1, 1, 1)
    nameLabel.TextStrokeTransparency = 0
    nameLabel.TextScaled = true
    nameLabel.Font = Enum.Font.SourceSansBold
    nameLabel.Parent = espName

    ESP_Objects[player] = {
        Box = espBox,
        Name = espName
    }
end

-- Function to remove ESP for a player
local function removeESP(player)
    if not ESP_Objects[player] then return end
    
    local objects = ESP_Objects[player]
    if objects.Box then objects.Box:Destroy() end
    if objects.Name then objects.Name:Destroy() end
    
    ESP_Objects[player] = nil
end

-- Function to toggle ESP visibility
local function toggleESP()
    for player, objects in pairs(ESP_Objects) do
        if objects.Box then
            objects.Box.Enabled = ESP_Enabled
        end
        if objects.Name then
            objects.Name.Enabled = ESP_Enabled
        end
    end
end

-- Main update loop
local connection
connection = RunService.RenderStepped:Connect(function()
    if not ESP_Enabled then
        -- If disabled, clear all ESP objects
        for player, _ in pairs(ESP_Objects) do
            removeESP(player)
        end
        return
    end

    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            if not ESP_Objects[player] then
                createESP(player)
            end
        end
    end

    -- Clean up ESP for players who left
    for player, _ in pairs(ESP_Objects) do
        if not player or not player.Parent then
            removeESP(player)
        end
    end
end)

-- Example of how to toggle the ESP with a key press (e.g., "F" key)
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.F then
        ESP_Enabled = not ESP_Enabled
        toggleESP()
        print("ESP is now " .. (ESP_Enabled and "ENABLED" or "DISABLED"))
    end
end)

-- Clean up on script reset or player leaving
game.Players.PlayerRemoving:Connect(function(player)
    removeESP(player)
end)

LocalPlayer.CharacterAdded:Connect(function()
    -- Re-run the ESP logic if the local player's character respawns
    -- This is a simple way to handle potential issues on respawn
end)
